<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet author="v.darmakheev" id="20.04.2018-1">
        <createTable tableName="books">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор книги">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="title" type="VARCHAR(255)" remarks="название книги"/>
            <column name="subtitle" type="VARCHAR(2000)" remarks="подзаголов"/>
            <column name="edition" type="INT" remarks="номер издания"/>
            <column name="isbn" type="VARCHAR(255)" remarks="международный стандартный книжный номер"/>
            <column name="udc" type="VARCHAR(255)" remarks="индекс универсальной десятичной классификации"/>
            <column name="bbk" type="VARCHAR(255)" remarks="индекс библиотечно - библиографической классификации"/>
            <column name="publication_year" type="INT" remarks="год издания"/>
            <column name="circulation" type="INT" remarks="тираж"/>
            <column name="price" type="DECIMAL" remarks="цена"/>
            <column name="in_stock" type="INT" remarks="в наличии"/>
            <column name="publisher_id" type="BIGINT" remarks="уникальный идентификатор издательства"/>
            <column name="book_series_id" type="BIGINT" remarks="уникальный идентификатор книжной серии"/>
            <column name="city_id" type="BIGINT" remarks="уникальный идентификатор города издания"/>
            <column name="language_id" type="BIGINT" remarks="уникальный идентификатор языка издания"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-2">
        <createTable tableName="authors">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор автора">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="first_name" type="VARCHAR(255)" remarks="имя"/>
            <column name="middle_name" type="VARCHAR(255)" remarks="отчество"/>
            <column name="last_name" type="VARCHAR(255)" remarks="фамилия"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-3">
        <createTable tableName="book_authors">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор записи">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="author_id" type="BIGINT" remarks="уникальный идентификатор автора"/>
            <column name="position" type="INT" remarks="позиция в списке авторов"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-4">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="book_authors"
                                 constraintName="book_id_book_authors_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-5">
        <addForeignKeyConstraint baseColumnNames="author_id"
                                 baseTableName="book_authors"
                                 constraintName="author_id_book_authors_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="authors"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-6">
        <createTable tableName="publishers">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор издательства">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название издательства"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-7">
        <addForeignKeyConstraint baseColumnNames="publisher_id"
                                 baseTableName="books"
                                 constraintName="publisher_id_books_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="publishers"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-8">
        <createTable tableName="book_series">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор книжной серии">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название серии"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="publisher_id" type="BIGINT" remarks="уникальный идентификатор издательства"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-9">
        <addForeignKeyConstraint baseColumnNames="publisher_id"
                                 baseTableName="book_series"
                                 constraintName="publisher_id_book_series_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="publishers"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-10">
        <createTable tableName="cities">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор города">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название города"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="code_city" type="VARCHAR(255)" remarks="код города"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-11">
        <addForeignKeyConstraint baseColumnNames="city_id"
                                 baseTableName="books"
                                 constraintName="city_id_books_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="cities"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-12">
        <createTable tableName="languages">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор языка издания">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название языка"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="code_language" type="VARCHAR(255)" remarks="код языка"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-13">
        <addForeignKeyConstraint baseColumnNames="language_id"
                                 baseTableName="books"
                                 constraintName="language_id_books_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="languages"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-14">
        <createTable tableName="categories">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор категории">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название категории"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="code_category" type="VARCHAR(255)" remarks="код категории"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-15">
        <createTable tableName="book_categories">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор записи">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="category_id" type="BIGINT" remarks="уникальный идентификатор категории"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-16">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="book_categories"
                                 constraintName="book_id_book_categories_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="20.04.2018-17">
        <addForeignKeyConstraint baseColumnNames="category_id"
                                 baseTableName="book_categories"
                                 constraintName="category_id_book_categories_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="categories"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="23.04.2018-1">
        <createTable tableName="orders">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор заказа">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT" remarks="уникальный идентификатор пользователя"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="first_name" type="VARCHAR(255)" remarks="имя получателя заказа"/>
            <column name="middle_name" type="VARCHAR(255)" remarks="отчество получателя заказа"/>
            <column name="last_name" type="VARCHAR(255)" remarks="фамилия получателя заказа"/>
            <column name="email" type="VARCHAR(255)" remarks="email получателя заказа"/>
            <column name="phone_number" type="VARCHAR(255)" remarks="телефон получателя заказа"/>
            <column name="shipping_address" type="VARCHAR(255)" remarks="телефон получателя заказа"/>
            <column name="payment_method" type="VARCHAR(255)" remarks="способ оплаты заказа"/>
            <column name="total_cost" type="DECIMAL" remarks="общая стоимость"/>
            <column name="discount" type="DECIMAL" remarks="скидка"/>
            <column name="to_pay" type="DECIMAL" remarks="к оплате"/>
            <column name="pay_for" type="DECIMAL" remarks="оплачено"/>
            <column name="status" type="VARCHAR(255)" remarks="статус заказа"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="23.04.2018-2">
        <createTable tableName="order_items">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="order_id" type="BIGINT" remarks="уникальный идентификатор заказа"/>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="count" type="INT" remarks="количетсво книг с указанным id в заказе"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="23.04.2018-3">
        <addForeignKeyConstraint baseColumnNames="order_id"
                                 baseTableName="order_items"
                                 constraintName="order_id_order_item_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="orders"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="23.04.2018-4">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="order_items"
                                 constraintName="book_id_order_item_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="26.04.2018-1">
        <createTable tableName="basket">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор корзины">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT" remarks="уникальный идентификатор пользователя"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="26.04.2018-2">
        <createTable tableName="basket_items">
            <column name="id" type="BIGINT" remarks="уникальный идентификатор">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="basket_id" type="BIGINT" remarks="уникальный идентификатор корзины"/>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="count" type="INT" remarks="количетсво книг с указанным id в корзине"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="26.04.2018-3">
        <addForeignKeyConstraint baseColumnNames="basket_id"
                                 baseTableName="basket_items"
                                 constraintName="basket_id_basket_items_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="basket"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="26.04.2018-4">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="basket_items"
                                 constraintName="book_id_basket_items_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>

</databaseChangeLog>

