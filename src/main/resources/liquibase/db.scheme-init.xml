<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <changeSet author="v.darmakheev" id="scheme-init-1">
        <createTable tableName="books">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор книги">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="title" type="VARCHAR(255)" remarks="название книги"/>
            <column name="subtitle" type="VARCHAR(2000)" remarks="подзаголов"/>
            <column name="edition" type="INT" remarks="номер издания"/>
            <column name="isbn" type="VARCHAR(255)" remarks="международный стандартный книжный номер"/>
            <column name="udc" type="VARCHAR(255)" remarks="индекс универсальной десятичной классификации"/>
            <column name="bbk" type="VARCHAR(255)" remarks="индекс библиотечно - библиографической классификации"/>
            <column name="publication_year" type="INT" remarks="год издания"/>
            <column name="circulation" type="INT" remarks="тираж"/>
            <column name="price" type="DECIMAL" remarks="цена"/>
            <column name="in_stock" type="INT" remarks="в наличии"/>
            <column name="weight" type="INT" remarks="вес в граммах"/>
            <column name="age_limit" type="VARCHAR(255)" remarks="возрастное ограничение"/>
            <column name="format" type="VARCHAR(255)" remarks="формат книги"/>
            <column name="cover_type" type="VARCHAR(255)" remarks="тип обложки"/>
            <column name="page_count" type="INT" remarks="количество страниц"/>
            <column name="publisher_id" type="BIGINT" remarks="уникальный идентификатор издательства"/>
            <column name="book_series_id" type="BIGINT" remarks="уникальный идентификатор книжной серии"/>
            <column name="city_id" type="BIGINT" remarks="уникальный идентификатор города издания"/>
            <column name="language_id" type="BIGINT" remarks="уникальный идентификатор языка издания"/>
            <column name="cover_file_id" type="BIGINT" remarks="идентификатор файла обложки"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-2">
        <createTable tableName="authors">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор автора">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="first_name" type="VARCHAR(255)" remarks="имя"/>
            <column name="middle_name" type="VARCHAR(255)" remarks="отчество"/>
            <column name="last_name" type="VARCHAR(255)" remarks="фамилия"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-3">
        <createTable tableName="book_authors">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор записи">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="author_id" type="BIGINT" remarks="уникальный идентификатор автора"/>
            <column name="position" type="INT" remarks="позиция в списке авторов"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-4">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="book_authors"
                                 constraintName="book_id_book_authors_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-5">
        <addForeignKeyConstraint baseColumnNames="author_id"
                                 baseTableName="book_authors"
                                 constraintName="author_id_book_authors_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="authors"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-6">
        <createTable tableName="publishers">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор издательства">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название издательства"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-7">
        <addForeignKeyConstraint baseColumnNames="publisher_id"
                                 baseTableName="books"
                                 constraintName="publisher_id_books_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="publishers"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-8">
        <createTable tableName="book_series">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор книжной серии">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название серии"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="publisher_id" type="BIGINT" remarks="уникальный идентификатор издательства"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-9">
        <addForeignKeyConstraint baseColumnNames="publisher_id"
                                 baseTableName="book_series"
                                 constraintName="publisher_id_book_series_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="publishers"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-10">
        <createTable tableName="cities">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор города">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название города"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="code_city" type="VARCHAR(255)" remarks="код города"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-11">
        <addForeignKeyConstraint baseColumnNames="city_id"
                                 baseTableName="books"
                                 constraintName="city_id_books_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="cities"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-12">
        <createTable tableName="languages">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор языка издания">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название языка"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="code_language" type="VARCHAR(255)" remarks="код языка"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-13">
        <addForeignKeyConstraint baseColumnNames="language_id"
                                 baseTableName="books"
                                 constraintName="language_id_books_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="languages"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-14">
        <createTable tableName="categories">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор категории">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="название категории"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="code_category" type="VARCHAR(255)" remarks="код категории"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-15">
        <createTable tableName="book_categories">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор записи">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="category_id" type="BIGINT" remarks="уникальный идентификатор категории"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-16">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="book_categories"
                                 constraintName="book_id_book_categories_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-17">
        <addForeignKeyConstraint baseColumnNames="category_id"
                                 baseTableName="book_categories"
                                 constraintName="category_id_book_categories_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="categories"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-18">
        <createTable tableName="orders">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор заказа">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT" remarks="уникальный идентификатор пользователя"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
            <column name="first_name" type="VARCHAR(255)" remarks="имя получателя заказа"/>
            <column name="middle_name" type="VARCHAR(255)" remarks="отчество получателя заказа"/>
            <column name="last_name" type="VARCHAR(255)" remarks="фамилия получателя заказа"/>
            <column name="email" type="VARCHAR(255)" remarks="email получателя заказа"/>
            <column name="phone_number" type="VARCHAR(255)" remarks="телефон получателя заказа"/>
            <column name="shipping_address" type="VARCHAR(255)" remarks="телефон получателя заказа"/>
            <column name="payment_method" type="VARCHAR(255)" remarks="способ оплаты заказа"/>
            <column name="total_cost" type="DECIMAL" remarks="общая стоимость"/>
            <column name="discount" type="DECIMAL" remarks="скидка"/>
            <column name="to_pay" type="DECIMAL" remarks="к оплате"/>
            <column name="pay_for" type="DECIMAL" remarks="оплачено"/>
            <column name="status" type="VARCHAR(255)" remarks="статус заказа"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-19">
        <createTable tableName="order_items">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="order_id" type="BIGINT" remarks="уникальный идентификатор заказа"/>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="count" type="INT" remarks="количетсво книг с указанным id в заказе"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-20">
        <addForeignKeyConstraint baseColumnNames="order_id"
                                 baseTableName="order_items"
                                 constraintName="order_id_order_item_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="orders"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-21">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="order_items"
                                 constraintName="book_id_order_item_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-22">
        <createTable tableName="cart">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор корзины">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="VARCHAR(255)" remarks="уникальный идентификатор пользователя"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-23">
        <createTable tableName="cart_items">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="cart_id" type="BIGINT" remarks="уникальный идентификатор корзины"/>
            <column name="book_id" type="BIGINT" remarks="уникальный идентификатор книги"/>
            <column name="count" type="INT" remarks="количетсво книг с указанным id в корзине"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-24">
        <addForeignKeyConstraint baseColumnNames="cart_id"
                                 baseTableName="cart_items"
                                 constraintName="cart_id_cart_items_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="cart"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-25">
        <addForeignKeyConstraint baseColumnNames="book_id"
                                 baseTableName="cart_items"
                                 constraintName="book_id_cart_items_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="books"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-26">
        <createTable tableName="files">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор файла">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" remarks="оригинальное название файла"/>
            <column name="bucket" type="VARCHAR(255)" remarks="Бакет файла в s3"/>
            <column name="key" type="VARCHAR(255)" remarks="ключ файла в s3"/>
            <column name="mime_type" type="VARCHAR(255)" remarks="тип контента"/>
            <column name="file_size" type="BIGINT" remarks="размер файла"/>
            <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="признак удаления"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-27">
        <addForeignKeyConstraint baseColumnNames="cover_file_id"
                                 baseTableName="books"
                                 constraintName="cover_file_id_books_fkey"
                                 deferrable="false"
                                 initiallyDeferred="false"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedColumnNames="id"
                                 referencedTableName="files"/>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-28">
        <createTable tableName="s3init">
            <column autoIncrement="true" name="id" type="BIGINT" remarks="уникальный идентификатор">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="init" type="BOOLEAN" remarks="был ли проинициализирован s3"/>
        </createTable>
    </changeSet>
    <changeSet author="v.darmakheev" id="scheme-init-29" dbms="postgresql">
        <sql>
            ALTER SEQUENCE authors_id_seq RESTART with 1000000;
            ALTER SEQUENCE book_authors_id_seq RESTART with 1000000;
            ALTER SEQUENCE book_categories_id_seq RESTART with 1000000;
            ALTER SEQUENCE book_series_id_seq RESTART with 1000000;
            ALTER SEQUENCE books_id_seq RESTART with 1000000;
            ALTER SEQUENCE cart_id_seq RESTART with 1000000;
            ALTER SEQUENCE cart_items_id_seq RESTART with 1000000;
            ALTER SEQUENCE categories_id_seq RESTART with 1000000;
            ALTER SEQUENCE cities_id_seq RESTART with 1000000;
            ALTER SEQUENCE files_id_seq RESTART with 1000000;
            ALTER SEQUENCE languages_id_seq RESTART with 1000000;
            ALTER SEQUENCE order_items_id_seq RESTART with 1000000;
            ALTER SEQUENCE orders_id_seq RESTART with 1000000;
            ALTER SEQUENCE publishers_id_seq RESTART with 1000000;
            ALTER SEQUENCE s3init_id_seq RESTART with 1000000;
        </sql>
    </changeSet>

</databaseChangeLog>

